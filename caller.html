<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>L√¥ T√¥ VN ‚Äî Ng∆∞·ªùi g·ªçi</title>
        <link rel="stylesheet" href="./style.css" />
        </head>
        <body>
        <header class="topbar">
          <div class="container topbar__inner">
              <div>
                    <h1 class="title">üé§ Ng∆∞·ªùi g·ªçi</h1>
                          <p class="subtitle">B·ªëc s·ªë 1‚Äì90 kh√¥ng tr√πng. B·∫•m ‚ÄúL·ªãch s·ª≠‚Äù ƒë·ªÉ xem c√°c s·ªë ƒë√£ ra. Caller c≈©ng tick t·ªù nh∆∞ b√¨nh th∆∞·ªùng.</p>
                              </div>
                                </div>
                                </header>

                                <main class="container stack">
                                  <section class="card">
                                      <div class="card__head">
                                            <div class="row">
                                                    <div class="pill">Seed t·ªù: <code id="seedText">--</code></div>
                                                            <div class="pill">üì£ ƒê√£ g·ªçi: <b id="calledCount">0</b>/90</div>
                                                                    <div class="pill">‚úÖ Tick: <b id="markedCount">0</b></div>
                                                                          </div>
                                                                              </div>

                                                                                  <div class="card__body stack">
                                                                                        <div class="bigNumber" id="currentNumber">--</div>

                                                                                              <div class="btnbar">
                                                                                                      <button id="btnDraw" class="btn btn--primary" type="button">üé≤ B·ªëc s·ªë</button>
                                                                                                              <button id="btnHistory" class="btn" type="button">üßæ L·ªãch s·ª≠ s·ªë ƒë√£ ra</button>
                                                                                                                      <button id="btnResetCall" class="btn btn--danger" type="button">üîÑ Reset l∆∞·ª£t g·ªçi</button>
                                                                                                                              <button id="btnNewGame" class="btn" type="button">üÜï V√°n m·ªõi (t·ªù m·ªõi + reset g·ªçi)</button>
                                                                                                                                      <a class="btn" href="./index.html">üè† V·ªÅ trang ch·ªçn vai</a>
                                                                                                                                            </div>
                                                                                                                                                </div>
                                                                                                                                                  </section>

                                                                                                                                                    <section class="card">
                                                                                                                                                        <div class="card__head">
                                                                                                                                                              <h2 class="title" style="font-size:15px;margin:0;">T·ªù L√¥ T√¥ (90 s·ªë)</h2>
                                                                                                                                                                    <p class="subtitle">√î n√†o ƒë√£ g·ªçi s·∫Ω highlight v√†ng. B·∫°n tick xanh n·∫øu mu·ªën t·ª± theo d√µi.</p>
                                                                                                                                                                        </div>
                                                                                                                                                                            <div class="card__body">
                                                                                                                                                                                  <div id="grid" class="grid"></div>
                                                                                                                                                                                      </div>
                                                                                                                                                                                        </section>

                                                                                                                                                                                          <div class="footer">Ch∆°i offline: ng∆∞·ªùi tr√∫ng t·ª± la l√™n t·∫°i ch·ªó.</div>
                                                                                                                                                                                          </main>

                                                                                                                                                                                          <!-- History Modal -->
                                                                                                                                                                                          <div id="backdrop" class="backdrop" role="dialog" aria-modal="true">
                                                                                                                                                                                            <div class="modal">
                                                                                                                                                                                                <div class="modal__head">
                                                                                                                                                                                                      <div>
                                                                                                                                                                                                              <div class="title" style="font-size:15px;margin:0;">L·ªãch s·ª≠ s·ªë ƒë√£ ra</div>
                                                                                                                                                                                                                      <div class="subtitle">Th·ª© t·ª± g·ªçi (t·ª´ ƒë·∫ßu ‚Üí t·ªõi hi·ªán t·∫°i).</div>
                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                  <button id="btnClose" class="btn btn--ghost btn--small" type="button">‚úñ</button>
                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                          <div class="modal__body">
                                                                                                                                                                                                                                                <div id="historyChips" class="chips"></div>
                                                                                                                                                                                                                                                      <div id="historyEmpty" class="subtitle" style="display:none;margin-top:6px;">Ch∆∞a c√≥ s·ªë n√†o ƒë∆∞·ª£c g·ªçi.</div>
                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                                                            <script>
                                                                                                                                                                                                                                                              // ===== Seed & deterministic shuffle (for card layout only) =====
                                                                                                                                                                                                                                                                function bytesToHex(bytes){
                                                                                                                                                                                                                                                                    return [...bytes].map(b => b.toString(16).padStart(2,'0')).join('');
                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                        function makeSeed128(){
                                                                                                                                                                                                                                                                            const buf = new Uint8Array(16);
                                                                                                                                                                                                                                                                                crypto.getRandomValues(buf);
                                                                                                                                                                                                                                                                                    return bytesToHex(buf);
                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                        function mulberry32(a){
                                                                                                                                                                                                                                                                                            return function(){
                                                                                                                                                                                                                                                                                                  let t = a += 0x6D2B79F5;
                                                                                                                                                                                                                                                                                                        t = Math.imul(t ^ (t >>> 15), t | 1);
                                                                                                                                                                                                                                                                                                              t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                                                                                                                                                                                                                                                                                                                    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                            function seedToUint32(seedHex){
                                                                                                                                                                                                                                                                                                                                let x = 0;
                                                                                                                                                                                                                                                                                                                                    for (let i=0; i<seedHex.length; i+=8){
                                                                                                                                                                                                                                                                                                                                          const chunk = parseInt(seedHex.slice(i, i+8), 16) >>> 0;
                                                                                                                                                                                                                                                                                                                                                x = (x ^ chunk) >>> 0;
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                        return x >>> 0;
                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                            function makePermutation90(seedHex){
                                                                                                                                                                                                                                                                                                                                                                const rand = mulberry32(seedToUint32(seedHex));
                                                                                                                                                                                                                                                                                                                                                                    const arr = Array.from({length:90}, (_,i)=>i+1);
                                                                                                                                                                                                                                                                                                                                                                        for (let i = arr.length - 1; i > 0; i--){
                                                                                                                                                                                                                                                                                                                                                                              const j = Math.floor(rand() * (i + 1));
                                                                                                                                                                                                                                                                                                                                                                                    [arr[i], arr[j]] = [arr[j], arr[i]];
                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                            return arr;
                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                // ===== Crypto random int for drawing numbers =====
                                                                                                                                                                                                                                                                                                                                                                                                  function cryptoRandInt(min, max){
                                                                                                                                                                                                                                                                                                                                                                                                      const range = max - min + 1;
                                                                                                                                                                                                                                                                                                                                                                                                          const maxUnbiased = Math.floor(0x100000000 / range) * range;
                                                                                                                                                                                                                                                                                                                                                                                                              let x;
                                                                                                                                                                                                                                                                                                                                                                                                                  do {
                                                                                                                                                                                                                                                                                                                                                                                                                        x = crypto.getRandomValues(new Uint32Array(1))[0];
                                                                                                                                                                                                                                                                                                                                                                                                                            } while (x >= maxUnbiased);
                                                                                                                                                                                                                                                                                                                                                                                                                                return min + (x % range);
                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                    // ===== State =====
                                                                                                                                                                                                                                                                                                                                                                                                                                      const LS_KEY = "loto_caller_mobile_v1";
                                                                                                                                                                                                                                                                                                                                                                                                                                        let state = {
                                                                                                                                                                                                                                                                                                                                                                                                                                            seed: null,       // card seed
                                                                                                                                                                                                                                                                                                                                                                                                                                                marked: [],
                                                                                                                                                                                                                                                                                                                                                                                                                                                    called: [],       // in call order
                                                                                                                                                                                                                                                                                                                                                                                                                                                        current: null
                                                                                                                                                                                                                                                                                                                                                                                                                                                          };

                                                                                                                                                                                                                                                                                                                                                                                                                                                            function loadState(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                const raw = localStorage.getItem(LS_KEY);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (raw){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          try { state = { ...state, ...JSON.parse(raw) }; } catch {}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (!state.seed) state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (!Array.isArray(state.marked)) state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (!Array.isArray(state.called)) state.called = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              function saveState(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  localStorage.setItem(LS_KEY, JSON.stringify(state));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // ===== UI refs =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const seedText = document.getElementById("seedText");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const calledCount = document.getElementById("calledCount");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const markedCount = document.getElementById("markedCount");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const currentNumber = document.getElementById("currentNumber");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const grid = document.getElementById("grid");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const btnDraw = document.getElementById("btnDraw");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const btnHistory = document.getElementById("btnHistory");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const btnResetCall = document.getElementById("btnResetCall");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const btnNewGame = document.getElementById("btnNewGame");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const backdrop = document.getElementById("backdrop");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const btnClose = document.getElementById("btnClose");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const historyChips = document.getElementById("historyChips");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const historyEmpty = document.getElementById("historyEmpty");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // ===== Runtime sets =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    let perm = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      let markedSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        let calledSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          let cellByNumber = new Map();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            function renderHeader(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                seedText.textContent = state.seed;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    calledCount.textContent = String(state.called.length);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        markedCount.textContent = String(markedSet.size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            currentNumber.textContent = state.current == null ? "--" : String(state.current);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function renderGrid(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    grid.innerHTML = "";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cellByNumber.clear();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            perm.forEach(n => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const b = document.createElement("button");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.type = "button";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.className = "cell";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.textContent = n;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (calledSet.has(n)) b.classList.add("is-called");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (markedSet.has(n)) b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (state.current === n) b.classList.add("is-now");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (markedSet.has(n)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedSet.delete(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          markedSet.add(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    state.marked = [...markedSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedCount.textContent = String(markedSet.size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                grid.appendChild(b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      cellByNumber.set(n, b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              function drawNumber(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (state.called.length >= 90){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        alert("ƒê√£ g·ªçi h·∫øt 90 s·ªë r·ªìi!");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // build remaining pool (fast enough for 90)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const remaining = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let i=1;i<=90;i++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!calledSet.has(i)) remaining.push(i);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const idx = cryptoRandInt(0, remaining.length - 1);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const n = remaining[idx];

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // update state
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        state.current = n;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.called.push(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                calledSet.add(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    saveState();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // update grid styles
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            grid.querySelectorAll(".cell.is-now").forEach(el => el.classList.remove("is-now"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const cell = cellByNumber.get(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (cell){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cell.classList.add("is-called");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cell.classList.add("is-now");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      cell.scrollIntoView({block:"nearest", inline:"nearest"});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              renderHeader();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function openHistory(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      historyChips.innerHTML = "";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (state.called.length === 0){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                historyEmpty.style.display = "block";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          historyEmpty.style.display = "none";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                state.called.forEach(n => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const chip = document.createElement("span");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                chip.className = "chip";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        chip.textContent = n;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                historyChips.appendChild(chip);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              backdrop.classList.add("open");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function closeHistory(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      backdrop.classList.remove("open");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function resetCallOnly(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // gi·ªØ seed t·ªù + gi·ªØ tick c·ªßa caller (ƒë√∫ng ch∆°i th·∫≠t: ch·ªâ reset s·ªë g·ªçi)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  state.called = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      state.current = null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          calledSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              saveState();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // remove called styles
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      grid.querySelectorAll(".cell.is-called").forEach(el => el.classList.remove("is-called"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          grid.querySelectorAll(".cell.is-now").forEach(el => el.classList.remove("is-now"));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              renderHeader();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function newGame(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // v√°n m·ªõi: t·ªù m·ªõi + reset g·ªçi + reset tick
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  state.called = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      state.current = null;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          markedSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              calledSet = new Set();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  perm = makePermutation90(state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      saveState();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          renderGrid();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              renderHeader();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // ===== Boot =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    loadState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      markedSet = new Set(state.marked);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        calledSet = new Set(state.called);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          perm = makePermutation90(state.seed);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            renderGrid();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              renderHeader();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // ===== Events =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  btnDraw.addEventListener("click", drawNumber);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    btnHistory.addEventListener("click", openHistory);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      btnResetCall.addEventListener("click", resetCallOnly);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        btnNewGame.addEventListener("click", newGame);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          btnClose.addEventListener("click", closeHistory);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            backdrop.addEventListener("click", (e) => { if (e.target === backdrop) closeHistory(); });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeHistory(); });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </html>