<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Ng∆∞·ªùi ch∆°i - L√¥ T√¥ Vi·ªát Nam</title>
        <link rel="stylesheet" href="./style.css" />
        </head>
        <body>
        <header class="topbar">
          <div class="container topbar__inner">
              <div>
                    <h1 class="title">üë§ Ng∆∞·ªùi ch∆°i</h1>
                          <p class="subtitle">Ch·∫°m v√†o s·ªë ƒë·ªÉ ƒë√°nh d·∫•u ho·∫∑c b·ªè ƒë√°nh d·∫•u.</p>
                              </div>
                                </div>
                                </header>

                                <main class="container stack">
                                  <section class="card">
                                      <div class="card__head">
                                            <div class="row">
                                                    <div class="pill">M√£ t·ªù: <code id="seedText">--</code></div>
                                                            <div class="pill">‚úÖ ƒê√£ ƒë√°nh d·∫•u: <b id="markedCount">0</b></div>
                                                                  </div>
                                                                      </div>

                                                                          <div class="card__body stack">
                                                                                <div class="btnbar">
                                                                                        <button id="btnNewCard" class="btn btn--primary" type="button">üÜï T·ªù m·ªõi</button>
                                                                                                <button id="btnResetMarks" class="btn btn--danger" type="button">üßΩ X√≥a ƒë√°nh d·∫•u</button>
                                                                                                        <button id="btnCopyLink" class="btn" type="button">üîó Sao ch√©p li√™n k·∫øt t·ªù</button>
                                                                                                                <a class="btn" href="./index.html">üè† Quay l·∫°i</a>
                                                                                                                      </div>
                                                                                                                          </div>
                                                                                                                            </section>

                                                                                                                              <section class="card">
                                                                                                                                  <div class="card__head">
                                                                                                                                        <h2 class="title" style="font-size:15px;margin:0;">T·ªù L√¥ T√¥</h2>
                                                                                                                                              <p class="subtitle">9 h√†ng ‚Ä¢ 8 c·ªôt ‚Ä¢ M·ªói h√†ng c√≥ 5 s·ªë</p>
                                                                                                                                                  </div>
                                                                                                                                                      <div class="card__body">
                                                                                                                                                            <div class="ticket">
                                                                                                                                                                    <div id="grid" class="ticket__grid"></div>
                                                                                                                                                                          </div>
                                                                                                                                                                              </div>
                                                                                                                                                                                </section>

                                                                                                                                                                                  <div class="footer">Ch√∫c b·∫°n may m·∫Øn!</div>
                                                                                                                                                                                  </main>

                                                                                                                                                                                  <script>
                                                                                                                                                                                    // ========= Seed helpers =========
                                                                                                                                                                                      function bytesToHex(bytes){
                                                                                                                                                                                          return [...bytes].map(b => b.toString(16).padStart(2,'0')).join('');
                                                                                                                                                                                            }
                                                                                                                                                                                              function makeSeed128(){
                                                                                                                                                                                                  const buf = new Uint8Array(16);
                                                                                                                                                                                                      crypto.getRandomValues(buf);
                                                                                                                                                                                                          return bytesToHex(buf);
                                                                                                                                                                                                            }
                                                                                                                                                                                                              function mulberry32(a){
                                                                                                                                                                                                                  return function(){
                                                                                                                                                                                                                        let t = a += 0x6D2B79F5;
                                                                                                                                                                                                                              t = Math.imul(t ^ (t >>> 15), t | 1);
                                                                                                                                                                                                                                    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                                                                                                                                                                                                                                          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                  function seedToUint32(seedHex){
                                                                                                                                                                                                                                                      let x = 0;
                                                                                                                                                                                                                                                          for (let i=0; i<seedHex.length; i+=8){
                                                                                                                                                                                                                                                                const chunk = parseInt(seedHex.slice(i, i+8), 16) >>> 0;
                                                                                                                                                                                                                                                                      x = (x ^ chunk) >>> 0;
                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                              return x >>> 0;
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                  function shuffleWithRand(arr, rand){
                                                                                                                                                                                                                                                                                      for (let i = arr.length - 1; i > 0; i--){
                                                                                                                                                                                                                                                                                            const j = Math.floor(rand() * (i + 1));
                                                                                                                                                                                                                                                                                                  [arr[i], arr[j]] = [arr[j], arr[i]];
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                          return arr;
                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                              // ========= Ticket rules =========
                                                                                                                                                                                                                                                                                                                // 9 rows x 8 cols
                                                                                                                                                                                                                                                                                                                  // Col ranges:
                                                                                                                                                                                                                                                                                                                    // 0: 1-9
                                                                                                                                                                                                                                                                                                                      // 1: 10-19
                                                                                                                                                                                                                                                                                                                        // ...
                                                                                                                                                                                                                                                                                                                          // 7: 80-90
                                                                                                                                                                                                                                                                                                                            const ROWS = 9, COLS = 8;
                                                                                                                                                                                                                                                                                                                              const CAPS = [9,10,10,10,10,10,10,11]; // available unique numbers per column
                                                                                                                                                                                                                                                                                                                                const RANGES = [
                                                                                                                                                                                                                                                                                                                                    [1,9],
                                                                                                                                                                                                                                                                                                                                        [10,19],
                                                                                                                                                                                                                                                                                                                                            [20,29],
                                                                                                                                                                                                                                                                                                                                                [30,39],
                                                                                                                                                                                                                                                                                                                                                    [40,49],
                                                                                                                                                                                                                                                                                                                                                        [50,59],
                                                                                                                                                                                                                                                                                                                                                            [60,69],
                                                                                                                                                                                                                                                                                                                                                                [80,90],
                                                                                                                                                                                                                                                                                                                                                                  ];

                                                                                                                                                                                                                                                                                                                                                                    function buildTicket(seedHex){
                                                                                                                                                                                                                                                                                                                                                                        const rand = mulberry32(seedToUint32(seedHex));

                                                                                                                                                                                                                                                                                                                                                                            // 1) Decide how many numbers each column will have (sum = 45, each >=1, not exceed cap)
                                                                                                                                                                                                                                                                                                                                                                                const target = Array(COLS).fill(1);
                                                                                                                                                                                                                                                                                                                                                                                    let remaining = 45 - COLS; // 37
                                                                                                                                                                                                                                                                                                                                                                                        while (remaining > 0){
                                                                                                                                                                                                                                                                                                                                                                                              const candidates = [];
                                                                                                                                                                                                                                                                                                                                                                                                    for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                            if (target[c] < CAPS[c]) candidates.push(c);
                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                        const pick = candidates[Math.floor(rand() * candidates.length)];
                                                                                                                                                                                                                                                                                                                                                                                                                              target[pick]++;
                                                                                                                                                                                                                                                                                                                                                                                                                                    remaining--;
                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                            // 2) Create blank matrix of placements, each row exactly 5 filled
                                                                                                                                                                                                                                                                                                                                                                                                                                                const place = Array.from({length:ROWS}, ()=>Array(COLS).fill(false));
                                                                                                                                                                                                                                                                                                                                                                                                                                                    const usedInCol = Array(COLS).fill(0);

                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Helper: pick 5 columns for this row with remaining capacity
                                                                                                                                                                                                                                                                                                                                                                                                                                                            for (let r=0; r<ROWS; r++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // build list of columns with remaining slots
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const available = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (usedInCol[c] < target[c]) available.push(c);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // if (rare) available < 5, allow columns with smallest overflow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        let pickFrom = available.length >= 5 ? available : Array.from({length:COLS}, (_,i)=>i);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // weighted-ish: shuffle, then choose 5 with most remaining
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    shuffleWithRand(pickFrom, rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          pickFrom.sort((a,b)=> (target[b]-usedInCol[b]) - (target[a]-usedInCol[a]));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const chosen = pickFrom.slice(0,5);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // ensure unique columns
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const uniq = [...new Set(chosen)].slice(0,5);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // if uniq < 5 (very rare), top up by scanning others
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (uniq.length < 5){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for (let c=0;c<COLS && uniq.length<5;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (!uniq.includes(c)) uniq.push(c);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              uniq.forEach(c=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      place[r][c] = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              usedInCol[c]++;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // 3) Fix any column count mismatch (make sure usedInCol == target)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Simple balancing: if a column is over, move some cells to columns that are under.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    function rowHas(r, c){ return place[r][c]; }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        function rowCount(r){ return place[r].filter(Boolean).length; }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  while (usedInCol[c] > target[c]){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // find a row that has this col
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const rowsWith = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let r=0;r<ROWS;r++) if (rowHas(r,c)) rowsWith.push(r);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const r = rowsWith[Math.floor(rand()*rowsWith.length)];

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // find an underfilled column not in this row
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const under = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let cc=0;cc<COLS;cc++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (usedInCol[cc] < target[cc] && !rowHas(r,cc)) under.push(cc);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (under.length === 0) break;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const cc = under[Math.floor(rand()*under.length)];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // move
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            place[r][c] = false; usedInCol[c]--;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    place[r][cc] = true; usedInCol[cc]++;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // rowCount stays 5
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // 4) Assign numbers per column from range, unique, then sort ascending top->bottom
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const colNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const [lo, hi] = RANGES[c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const pool = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    for (let x=lo; x<=hi; x++) pool.push(x);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          shuffleWithRand(pool, rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const count = usedInCol[c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const picked = pool.slice(0, count).sort((a,b)=>a-b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            colNums[c] = picked;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 5) Place numbers into grid by column (top to bottom for that column)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const grid = Array.from({length:ROWS}, ()=>Array(COLS).fill(null));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const rows = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (let r=0;r<ROWS;r++) if (place[r][c]) rows.push(r);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              rows.sort((a,b)=>a-b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const nums = colNums[c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let i=0;i<rows.length;i++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  grid[rows[i]][c] = nums[i];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return grid; // null for empty, number for filled
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // ========= State =========
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const LS_KEY = "loto_player_ticket_v2";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        let state = { seed:null, marked:[] };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function loadState(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const raw = localStorage.getItem(LS_KEY);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (raw){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try { state = { ...state, ...JSON.parse(raw) }; } catch {}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const seedParam = url.searchParams.get("seed");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (seedParam && /^[0-9a-fA-F]{16,64}$/.test(seedParam)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const sp = seedParam.toLowerCase();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (state.seed !== sp){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.seed = sp;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (!state.seed) state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (!Array.isArray(state.marked)) state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // ========= UI =========
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const seedText = document.getElementById("seedText");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const markedCount = document.getElementById("markedCount");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const gridEl = document.getElementById("grid");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const btnNewCard = document.getElementById("btnNewCard");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const btnResetMarks = document.getElementById("btnResetMarks");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const btnCopyLink = document.getElementById("btnCopyLink");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          let markedSet = new Set();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            function render(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                seedText.textContent = state.seed;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedCount.textContent = String(markedSet.size);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const ticket = buildTicket(state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            gridEl.innerHTML = "";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for (let r=0;r<ROWS;r++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const val = ticket[r][c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const b = document.createElement("button");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.type = "button";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (val == null){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b.className = "cell cell--empty";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.textContent = " ";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.disabled = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      b.className = "cell";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b.textContent = String(val);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (markedSet.has(val)) b.classList.add("is-marked");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (markedSet.has(val)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedSet.delete(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      markedSet.add(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.marked = [...markedSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedCount.textContent = String(markedSet.size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              gridEl.appendChild(b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    history.replaceState({}, "", url);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        function newCard(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            render();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function resetMarksKeepSeed(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        markedSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                gridEl.querySelectorAll(".cell.is-marked").forEach(el => el.classList.remove("is-marked"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedCount.textContent = "0";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        async function copyLink(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await navigator.clipboard.writeText(url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                btnCopyLink.textContent = "‚úÖ ƒê√£ sao ch√©p";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      setTimeout(()=> btnCopyLink.textContent = "üîó Sao ch√©p li√™n k·∫øt t·ªù", 1200);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }catch{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                prompt("Sao ch√©p li√™n k·∫øt n√†y:", url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Boot
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          loadState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            markedSet = new Set(state.marked);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              render();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                btnNewCard.addEventListener("click", newCard);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  btnResetMarks.addEventListener("click", resetMarksKeepSeed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    btnCopyLink.addEventListener("click", copyLink);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </html>