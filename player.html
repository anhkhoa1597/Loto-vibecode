<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>L√¥ T√¥ VN ‚Äî Ng∆∞·ªùi ch∆°i</title>
        <link rel="stylesheet" href="./style.css" />
        </head>
        <body>
        <header class="topbar">
          <div class="container topbar__inner">
              <div>
                    <h1 class="title">üë§ Ng∆∞·ªùi ch∆°i</h1>
                          <p class="subtitle">B·∫•m √¥ ƒë·ªÉ tick / b·ªè tick. Reset ch·ªâ xo√° tick (gi·ªØ t·ªù). T·ªù m·ªõi = seed m·ªõi.</p>
                              </div>
                                </div>
                                </header>

                                <main class="container stack">
                                  <section class="card">
                                      <div class="card__head">
                                            <div class="row">
                                                    <div class="pill">Seed: <code id="seedText">--</code></div>
                                                            <div class="pill">‚úÖ Tick: <b id="markedCount">0</b></div>
                                                                  </div>
                                                                      </div>

                                                                          <div class="card__body stack">
                                                                                <div class="btnbar">
                                                                                        <button id="btnNewCard" class="btn btn--primary" type="button">üÜï T·ªù m·ªõi</button>
                                                                                                <button id="btnResetMarks" class="btn btn--danger" type="button">üßΩ Reset tick</button>
                                                                                                        <button id="btnCopyLink" class="btn" type="button">üîó Copy link t·ªù</button>
                                                                                                                <a class="btn" href="./index.html">üè† V·ªÅ trang ch·ªçn vai</a>
                                                                                                                      </div>

                                                                                                                            <div class="pill">
                                                                                                                                    L∆∞u √Ω: ch∆°i offline th√¨ m·ªói ng∆∞·ªùi t·ª± t·∫°o t·ªù. Seed d√πng crypto n√™n x√°c su·∫•t tr√πng g·∫ßn nh∆∞ 0.
                                                                                                                                          </div>
                                                                                                                                              </div>
                                                                                                                                                </section>

                                                                                                                                                  <section class="card">
                                                                                                                                                      <div class="card__head">
                                                                                                                                                            <h2 class="title" style="font-size:15px;margin:0;">T·ªù L√¥ T√¥ (90 s·ªë)</h2>
                                                                                                                                                                  <p class="subtitle">√î to ƒë·ªÉ d·ªÖ b·∫•m tr√™n mobile.</p>
                                                                                                                                                                      </div>
                                                                                                                                                                          <div class="card__body">
                                                                                                                                                                                <div id="grid" class="grid"></div>
                                                                                                                                                                                    </div>
                                                                                                                                                                                      </section>

                                                                                                                                                                                        <div class="footer">Tip: l·ª° reload v·∫´n c√≤n v√¨ c√≥ l∆∞u LocalStorage.</div>
                                                                                                                                                                                        </main>

                                                                                                                                                                                        <script>
                                                                                                                                                                                          // ===== Seed & deterministic shuffle =====
                                                                                                                                                                                            function bytesToHex(bytes){
                                                                                                                                                                                                return [...bytes].map(b => b.toString(16).padStart(2,'0')).join('');
                                                                                                                                                                                                  }
                                                                                                                                                                                                    function makeSeed128(){
                                                                                                                                                                                                        const buf = new Uint8Array(16);
                                                                                                                                                                                                            crypto.getRandomValues(buf);
                                                                                                                                                                                                                return bytesToHex(buf);
                                                                                                                                                                                                                  }
                                                                                                                                                                                                                    function mulberry32(a){
                                                                                                                                                                                                                        return function(){
                                                                                                                                                                                                                              let t = a += 0x6D2B79F5;
                                                                                                                                                                                                                                    t = Math.imul(t ^ (t >>> 15), t | 1);
                                                                                                                                                                                                                                          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                                                                                                                                                                                                                                                return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                        function seedToUint32(seedHex){
                                                                                                                                                                                                                                                            let x = 0;
                                                                                                                                                                                                                                                                for (let i=0; i<seedHex.length; i+=8){
                                                                                                                                                                                                                                                                      const chunk = parseInt(seedHex.slice(i, i+8), 16) >>> 0;
                                                                                                                                                                                                                                                                            x = (x ^ chunk) >>> 0;
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                    return x >>> 0;
                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                        function makePermutation90(seedHex){
                                                                                                                                                                                                                                                                                            const rand = mulberry32(seedToUint32(seedHex));
                                                                                                                                                                                                                                                                                                const arr = Array.from({length:90}, (_,i)=>i+1);
                                                                                                                                                                                                                                                                                                    for (let i = arr.length - 1; i > 0; i--){
                                                                                                                                                                                                                                                                                                          const j = Math.floor(rand() * (i + 1));
                                                                                                                                                                                                                                                                                                                [arr[i], arr[j]] = [arr[j], arr[i]];
                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                        return arr;
                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                            // ===== State =====
                                                                                                                                                                                                                                                                                                                              const LS_KEY = "loto_player_mobile_v1";
                                                                                                                                                                                                                                                                                                                                let state = { seed:null, marked:[] };

                                                                                                                                                                                                                                                                                                                                  function loadState(){
                                                                                                                                                                                                                                                                                                                                      const raw = localStorage.getItem(LS_KEY);
                                                                                                                                                                                                                                                                                                                                          if (raw){
                                                                                                                                                                                                                                                                                                                                                try { state = { ...state, ...JSON.parse(raw) }; } catch {}
                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                        // allow open by URL seed
                                                                                                                                                                                                                                                                                                                                                            const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                const seedParam = url.searchParams.get("seed");
                                                                                                                                                                                                                                                                                                                                                                    if (seedParam && /^[0-9a-fA-F]{16,64}$/.test(seedParam)){
                                                                                                                                                                                                                                                                                                                                                                          const sp = seedParam.toLowerCase();
                                                                                                                                                                                                                                                                                                                                                                                if (state.seed !== sp){
                                                                                                                                                                                                                                                                                                                                                                                        state.seed = sp;
                                                                                                                                                                                                                                                                                                                                                                                                state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                              if (!state.seed) state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                  if (!Array.isArray(state.marked)) state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                      function saveState(){
                                                                                                                                                                                                                                                                                                                                                                                                                          localStorage.setItem(LS_KEY, JSON.stringify(state));
                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                              // ===== UI =====
                                                                                                                                                                                                                                                                                                                                                                                                                                const seedText = document.getElementById("seedText");
                                                                                                                                                                                                                                                                                                                                                                                                                                  const markedCount = document.getElementById("markedCount");
                                                                                                                                                                                                                                                                                                                                                                                                                                    const grid = document.getElementById("grid");

                                                                                                                                                                                                                                                                                                                                                                                                                                      const btnNewCard = document.getElementById("btnNewCard");
                                                                                                                                                                                                                                                                                                                                                                                                                                        const btnResetMarks = document.getElementById("btnResetMarks");
                                                                                                                                                                                                                                                                                                                                                                                                                                          const btnCopyLink = document.getElementById("btnCopyLink");

                                                                                                                                                                                                                                                                                                                                                                                                                                            let perm = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                              let markedSet = new Set();

                                                                                                                                                                                                                                                                                                                                                                                                                                                function render(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                    seedText.textContent = state.seed;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        markedCount.textContent = String(markedSet.size);

                                                                                                                                                                                                                                                                                                                                                                                                                                                            grid.innerHTML = "";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                perm.forEach(n => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const b = document.createElement("button");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b.type = "button";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b.className = "cell" + (markedSet.has(n) ? " is-marked" : "");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.textContent = n;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (markedSet.has(n)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                markedSet.delete(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            markedSet.add(n);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      state.marked = [...markedSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      markedCount.textContent = String(markedSet.size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  grid.appendChild(b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // keep URL in sync (nice for share)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history.replaceState({}, "", url);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function newCard(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          markedSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              perm = makePermutation90(state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  render();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      function resetMarksKeepSeed(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          state.marked = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  markedSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // quick update without re-render whole grid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          grid.querySelectorAll(".cell.is-marked").forEach(el => el.classList.remove("is-marked"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedCount.textContent = "0";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  async function copyLink(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              try{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await navigator.clipboard.writeText(url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          btnCopyLink.textContent = "‚úÖ ƒê√£ copy";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setTimeout(()=> btnCopyLink.textContent = "üîó Copy link t·ªù", 1200);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }catch{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          prompt("Copy th·ªß c√¥ng link n√†y:", url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // ===== Boot =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    loadState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      markedSet = new Set(state.marked);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        perm = makePermutation90(state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          render();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // ===== Events =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              btnNewCard.addEventListener("click", newCard);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                btnResetMarks.addEventListener("click", resetMarksKeepSeed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  btnCopyLink.addEventListener("click", copyLink);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </html>