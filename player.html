<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Ng∆∞·ªùi ch∆°i - L√¥ T√¥ Vi·ªát Nam</title>
        <link rel="stylesheet" href="./style.css" />
        </head>
        <body>
        <header class="topbar">
          <div class="container topbar__inner">
              <div>
                    <h1 class="title">üë§ Ng∆∞·ªùi ch∆°i</h1>
                          <p class="subtitle">Ch·∫°m v√†o √¥ ƒë·ªÉ ƒë√°nh d·∫•u ho·∫∑c b·ªè ƒë√°nh d·∫•u.</p>
                              </div>
                                </div>
                                </header>

                                <main class="container stack">
                                  <section class="card">
                                      <div class="card__head">
                                            <div class="row">
                                                    <div class="pill">M√£ t·ªù: <code id="seedText">--</code></div>
                                                            <div class="pill">‚úÖ ƒê√£ ƒë√°nh d·∫•u: <b id="markedCount">0</b></div>
                                                                  </div>
                                                                      </div>

                                                                          <div class="card__body stack">
                                                                                <div class="btnbar">
                                                                                        <button id="btnNewCard" class="btn btn--primary" type="button">üÜï T·ªù m·ªõi</button>
                                                                                                <button id="btnResetMarks" class="btn btn--danger" type="button">üßΩ X√≥a ƒë√°nh d·∫•u</button>
                                                                                                        <button id="btnCopyLink" class="btn" type="button">üîó Sao ch√©p li√™n k·∫øt t·ªù</button>
                                                                                                                <a class="btn" href="./index.html">üè† Quay l·∫°i</a>
                                                                                                                      </div>
                                                                                                                          </div>
                                                                                                                            </section>

                                                                                                                              <section class="card">
                                                                                                                                  <div class="card__head">
                                                                                                                                        <h2 class="title" style="font-size:15px;margin:0;">T·ªù L√¥ T√¥</h2>
                                                                                                                                              <p class="subtitle">9 h√†ng ‚Ä¢ 9 c·ªôt ‚Ä¢ M·ªói h√†ng 5 s·ªë</p>
                                                                                                                                                  </div>
                                                                                                                                                      <div class="card__body">
                                                                                                                                                            <div class="ticket">
                                                                                                                                                                    <div id="grid" class="ticket__grid"></div>
                                                                                                                                                                          </div>
                                                                                                                                                                              </div>
                                                                                                                                                                                </section>

                                                                                                                                                                                  <div class="footer">Ch√∫c b·∫°n may m·∫Øn!</div>
                                                                                                                                                                                  </main>

                                                                                                                                                                                  <script>
                                                                                                                                                                                    // ===== Seed helpers =====
                                                                                                                                                                                      function bytesToHex(bytes){
                                                                                                                                                                                          return [...bytes].map(b => b.toString(16).padStart(2,'0')).join('');
                                                                                                                                                                                            }
                                                                                                                                                                                              function makeSeed128(){
                                                                                                                                                                                                  const buf = new Uint8Array(16);
                                                                                                                                                                                                      crypto.getRandomValues(buf);
                                                                                                                                                                                                          return bytesToHex(buf);
                                                                                                                                                                                                            }
                                                                                                                                                                                                              function mulberry32(a){
                                                                                                                                                                                                                  return function(){
                                                                                                                                                                                                                        let t = a += 0x6D2B79F5;
                                                                                                                                                                                                                              t = Math.imul(t ^ (t >>> 15), t | 1);
                                                                                                                                                                                                                                    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                                                                                                                                                                                                                                          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                  function seedToUint32(seedHex){
                                                                                                                                                                                                                                                      let x = 0;
                                                                                                                                                                                                                                                          for (let i=0; i<seedHex.length; i+=8){
                                                                                                                                                                                                                                                                const chunk = parseInt(seedHex.slice(i, i+8), 16) >>> 0;
                                                                                                                                                                                                                                                                      x = (x ^ chunk) >>> 0;
                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                              return x >>> 0;
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                  function shuffleWithRand(arr, rand){
                                                                                                                                                                                                                                                                                      for (let i = arr.length - 1; i > 0; i--){
                                                                                                                                                                                                                                                                                            const j = Math.floor(rand() * (i + 1));
                                                                                                                                                                                                                                                                                                  [arr[i], arr[j]] = [arr[j], arr[i]];
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                          return arr;
                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                              // ===== Ticket rules =====
                                                                                                                                                                                                                                                                                                                const ROWS = 9, COLS = 9;

                                                                                                                                                                                                                                                                                                                  // 9 columns ranges:
                                                                                                                                                                                                                                                                                                                    // 1-9, 10-19, ... 70-79, 80-90
                                                                                                                                                                                                                                                                                                                      const RANGES = [
                                                                                                                                                                                                                                                                                                                          [1,9],
                                                                                                                                                                                                                                                                                                                              [10,19],
                                                                                                                                                                                                                                                                                                                                  [20,29],
                                                                                                                                                                                                                                                                                                                                      [30,39],
                                                                                                                                                                                                                                                                                                                                          [40,49],
                                                                                                                                                                                                                                                                                                                                              [50,59],
                                                                                                                                                                                                                                                                                                                                                  [60,69],
                                                                                                                                                                                                                                                                                                                                                      [70,79],
                                                                                                                                                                                                                                                                                                                                                          [80,90],
                                                                                                                                                                                                                                                                                                                                                            ];

                                                                                                                                                                                                                                                                                                                                                              // With 9 cols, total numbers = 45.
                                                                                                                                                                                                                                                                                                                                                                // Each column count must be 4..6 and sum=45.
                                                                                                                                                                                                                                                                                                                                                                  // Let x=#6, y=#5, z=#4: x+y+z=9 and 6x+5y+4z=45 => 2x+y=9
                                                                                                                                                                                                                                                                                                                                                                    // valid solutions:
                                                                                                                                                                                                                                                                                                                                                                      // (x=0,y=9,z=0) => all columns are 5
                                                                                                                                                                                                                                                                                                                                                                        // (x=1,y=7,z=1)
                                                                                                                                                                                                                                                                                                                                                                          // (x=2,y=5,z=2)
                                                                                                                                                                                                                                                                                                                                                                            // (x=3,y=3,z=3)
                                                                                                                                                                                                                                                                                                                                                                              // (x=4,y=1,z=4)
                                                                                                                                                                                                                                                                                                                                                                                function makeTargets(rand){
                                                                                                                                                                                                                                                                                                                                                                                    const solutions = [
                                                                                                                                                                                                                                                                                                                                                                                          {x:0,y:9,z:0},
                                                                                                                                                                                                                                                                                                                                                                                                {x:1,y:7,z:1},
                                                                                                                                                                                                                                                                                                                                                                                                      {x:2,y:5,z:2},
                                                                                                                                                                                                                                                                                                                                                                                                            {x:3,y:3,z:3},
                                                                                                                                                                                                                                                                                                                                                                                                                  {x:4,y:1,z:4},
                                                                                                                                                                                                                                                                                                                                                                                                                      ];
                                                                                                                                                                                                                                                                                                                                                                                                                          const pick = solutions[Math.floor(rand() * solutions.length)];
                                                                                                                                                                                                                                                                                                                                                                                                                              const target = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                  for (let i=0;i<pick.x;i++) target.push(6);
                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let i=0;i<pick.y;i++) target.push(5);
                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let i=0;i<pick.z;i++) target.push(4);
                                                                                                                                                                                                                                                                                                                                                                                                                                              shuffleWithRand(target, rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                  return target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                      function tryPlacement(target, seed32, attempt){
                                                                                                                                                                                                                                                                                                                                                                                                                                                          const r2 = mulberry32((seed32 ^ (attempt * 0x9e3779b9)) >>> 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                              const remaining = target.slice();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const place = Array.from({length:ROWS}, ()=>Array(COLS).fill(false));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let r=0; r<ROWS; r++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const cols = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (let c=0;c<COLS;c++) if (remaining[c] > 0) cols.push(c);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (cols.length < 5) return null;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cols.sort((a,b)=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const da = remaining[a], db = remaining[b];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (db !== da) return db - da;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return r2() - r2();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const chosen = cols.slice(0,5);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (const c of chosen){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                place[r][c] = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        remaining[c]--;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (remaining[c] < 0) return null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let c=0;c<COLS;c++) if (remaining[c] !== 0) return null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return place;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      function pickUniqueNumbers(lo, hi, count, rand){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const pool = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let x=lo; x<=hi; x++) pool.push(x);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  shuffleWithRand(pool, rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return pool.slice(0, count).sort((a,b)=>a-b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function buildTicket(seedHex){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const seed32 = seedToUint32(seedHex);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const rand = mulberry32(seed32);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const target = makeTargets(rand);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          let place = null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let attempt=0; attempt<800; attempt++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    place = tryPlacement(target, seed32, attempt);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (place) break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (!place) place = tryPlacement(target, seed32, 999999);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const colNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const [lo, hi] = RANGES[c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      colNums[c] = pickUniqueNumbers(lo, hi, target[c], rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const grid = Array.from({length:ROWS}, ()=>Array(COLS).fill(null));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const rows = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let r=0;r<ROWS;r++) if (place[r][c]) rows.push(r);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    rows.sort((a,b)=>a-b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let i=0;i<rows.length;i++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  grid[rows[i]][c] = colNums[c][i];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return grid;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // ===== State =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const LS_KEY = "loto_player_ticket_v5";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        let state = { seed: null, markedNums: [], markedCells: [] };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function loadState(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const raw = localStorage.getItem(LS_KEY);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (raw){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try { state = { ...state, ...JSON.parse(raw) }; } catch {}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const seedParam = url.searchParams.get("seed");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (seedParam && /^[0-9a-fA-F]{16,64}$/.test(seedParam)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const sp = seedParam.toLowerCase();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (state.seed !== sp){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.seed = sp;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (!state.seed) state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (!Array.isArray(state.markedNums)) state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (!Array.isArray(state.markedCells)) state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // ===== UI =====
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const seedText = document.getElementById("seedText");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const markedCount = document.getElementById("markedCount");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const gridEl = document.getElementById("grid");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const btnNewCard = document.getElementById("btnNewCard");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const btnResetMarks = document.getElementById("btnResetMarks");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const btnCopyLink = document.getElementById("btnCopyLink");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      let markedNumSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        let markedCellSet = new Set();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function updateCount(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedCount.textContent = String(markedNumSet.size + markedCellSet.size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function render(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      seedText.textContent = state.seed;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const ticket = buildTicket(state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              gridEl.innerHTML = "";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (let r=0;r<ROWS;r++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const val = ticket[r][c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const key = `${r}-${c}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const b = document.createElement("button");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.type = "button";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (val == null){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.className = "cell cell--empty";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.textContent = " ";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (markedCellSet.has(key)) b.classList.add("is-marked");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (markedCellSet.has(key)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  markedCellSet.delete(key);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          markedCellSet.add(key);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                state.markedCells = [...markedCellSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        updateCount();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.className = "cell";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.textContent = String(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (markedNumSet.has(val)) b.classList.add("is-marked");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (markedNumSet.has(val)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            markedNumSet.delete(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedNumSet.add(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          state.markedNums = [...markedNumSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  updateCount();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            gridEl.appendChild(b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          updateCount();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history.replaceState({}, "", url);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function newCard(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (!confirm("T·∫°o t·ªù m·ªõi? T·ªù hi·ªán t·∫°i s·∫Ω ƒë·ªïi m√£ v√† x√≥a to√†n b·ªô ƒë√°nh d·∫•u.")) return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedNumSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  markedCellSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          render();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              function resetMarksKeepSeed(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (!confirm("X√≥a to√†n b·ªô ƒë√°nh d·∫•u tr√™n t·ªù hi·ªán t·∫°i?")) return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedNumSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  markedCellSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          render();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              async function copyLink(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          try{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await navigator.clipboard.writeText(url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      btnCopyLink.textContent = "‚úÖ ƒê√£ sao ch√©p";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setTimeout(()=> btnCopyLink.textContent = "üîó Sao ch√©p li√™n k·∫øt t·ªù", 1200);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }catch{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      prompt("Sao ch√©p li√™n k·∫øt n√†y:", url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              loadState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                markedNumSet = new Set(state.markedNums);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  markedCellSet = new Set(state.markedCells);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    render();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      btnNewCard.addEventListener("click", newCard);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        btnResetMarks.addEventListener("click", resetMarksKeepSeed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          btnCopyLink.addEventListener("click", copyLink);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </html>