<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Ng∆∞·ªùi ch∆°i - L√¥ T√¥ Vi·ªát Nam</title>
        <link rel="stylesheet" href="./style.css" />
        </head>
        <body>
        <header class="topbar">
          <div class="container topbar__inner">
              <div>
                    <h1 class="title">üë§ Ng∆∞·ªùi ch∆°i</h1>
                          <p class="subtitle">Ch·∫°m v√†o √¥ ƒë·ªÉ ƒë√°nh d·∫•u ho·∫∑c b·ªè ƒë√°nh d·∫•u.</p>
                              </div>
                                </div>
                                </header>

                                <main class="container stack">
                                  <section class="card">
                                      <div class="card__head">
                                            <div class="row">
                                                    <div class="pill">M√£ t·ªù: <code id="seedText">--</code></div>
                                                            <div class="pill">‚úÖ ƒê√£ ƒë√°nh d·∫•u: <b id="markedCount">0</b></div>
                                                                  </div>
                                                                      </div>

                                                                          <div class="card__body stack">
                                                                                <div class="btnbar">
                                                                                        <button id="btnNewCard" class="btn btn--primary" type="button">üÜï T·ªù m·ªõi</button>
                                                                                                <button id="btnResetMarks" class="btn btn--danger" type="button">üßΩ X√≥a ƒë√°nh d·∫•u</button>
                                                                                                        <button id="btnCopyLink" class="btn" type="button">üîó Sao ch√©p li√™n k·∫øt t·ªù</button>
                                                                                                                <a class="btn" href="./index.html">üè† Quay l·∫°i</a>
                                                                                                                      </div>
                                                                                                                          </div>
                                                                                                                            </section>

                                                                                                                              <section class="card">
                                                                                                                                  <div class="card__head">
                                                                                                                                        <h2 class="title" style="font-size:15px;margin:0;">T·ªù L√¥ T√¥</h2>
                                                                                                                                              <p class="subtitle">9 h√†ng ‚Ä¢ 8 c·ªôt ‚Ä¢ M·ªói h√†ng 5 s·ªë ‚Ä¢ M·ªói c·ªôt 4‚Äì6 s·ªë</p>
                                                                                                                                                  </div>
                                                                                                                                                      <div class="card__body">
                                                                                                                                                            <div class="ticket">
                                                                                                                                                                    <div id="grid" class="ticket__grid"></div>
                                                                                                                                                                          </div>
                                                                                                                                                                              </div>
                                                                                                                                                                                </section>

                                                                                                                                                                                  <div class="footer">Ch√∫c b·∫°n may m·∫Øn!</div>
                                                                                                                                                                                  </main>

                                                                                                                                                                                  <script>
                                                                                                                                                                                    // ========= Seed helpers =========
                                                                                                                                                                                      function bytesToHex(bytes){
                                                                                                                                                                                          return [...bytes].map(b => b.toString(16).padStart(2,'0')).join('');
                                                                                                                                                                                            }
                                                                                                                                                                                              function makeSeed128(){
                                                                                                                                                                                                  const buf = new Uint8Array(16);
                                                                                                                                                                                                      crypto.getRandomValues(buf);
                                                                                                                                                                                                          return bytesToHex(buf);
                                                                                                                                                                                                            }
                                                                                                                                                                                                              function mulberry32(a){
                                                                                                                                                                                                                  return function(){
                                                                                                                                                                                                                        let t = a += 0x6D2B79F5;
                                                                                                                                                                                                                              t = Math.imul(t ^ (t >>> 15), t | 1);
                                                                                                                                                                                                                                    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                                                                                                                                                                                                                                          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                  function seedToUint32(seedHex){
                                                                                                                                                                                                                                                      let x = 0;
                                                                                                                                                                                                                                                          for (let i=0; i<seedHex.length; i+=8){
                                                                                                                                                                                                                                                                const chunk = parseInt(seedHex.slice(i, i+8), 16) >>> 0;
                                                                                                                                                                                                                                                                      x = (x ^ chunk) >>> 0;
                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                              return x >>> 0;
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                  function shuffleWithRand(arr, rand){
                                                                                                                                                                                                                                                                                      for (let i = arr.length - 1; i > 0; i--){
                                                                                                                                                                                                                                                                                            const j = Math.floor(rand() * (i + 1));
                                                                                                                                                                                                                                                                                                  [arr[i], arr[j]] = [arr[j], arr[i]];
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                          return arr;
                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                              // ========= Ticket rules =========
                                                                                                                                                                                                                                                                                                                const ROWS = 9, COLS = 8;

                                                                                                                                                                                                                                                                                                                  // ranges by column
                                                                                                                                                                                                                                                                                                                    const RANGES = [
                                                                                                                                                                                                                                                                                                                        [1,9],
                                                                                                                                                                                                                                                                                                                            [10,19],
                                                                                                                                                                                                                                                                                                                                [20,29],
                                                                                                                                                                                                                                                                                                                                    [30,39],
                                                                                                                                                                                                                                                                                                                                        [40,49],
                                                                                                                                                                                                                                                                                                                                            [50,59],
                                                                                                                                                                                                                                                                                                                                                [60,69],
                                                                                                                                                                                                                                                                                                                                                    [80,90],
                                                                                                                                                                                                                                                                                                                                                      ];

                                                                                                                                                                                                                                                                                                                                                        // Create per-column counts, EACH 4..6, sum = 45
                                                                                                                                                                                                                                                                                                                                                          function makeTargets(rand){
                                                                                                                                                                                                                                                                                                                                                              const target = Array(COLS).fill(4); // min 4 each => 32
                                                                                                                                                                                                                                                                                                                                                                  let remaining = 45 - 32; // 13 to distribute, each col can add max 2 (to reach 6)
                                                                                                                                                                                                                                                                                                                                                                      const capLeft = Array(COLS).fill(2);

                                                                                                                                                                                                                                                                                                                                                                          while (remaining > 0){
                                                                                                                                                                                                                                                                                                                                                                                const candidates = [];
                                                                                                                                                                                                                                                                                                                                                                                      for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                              if (capLeft[c] > 0) candidates.push(c);
                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                          const pick = candidates[Math.floor(rand() * candidates.length)];
                                                                                                                                                                                                                                                                                                                                                                                                                target[pick] += 1;
                                                                                                                                                                                                                                                                                                                                                                                                                      capLeft[pick] -= 1;
                                                                                                                                                                                                                                                                                                                                                                                                                            remaining -= 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                    return target; // each 4..6
                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                        // Try to place exactly 5 numbers per row and match target counts per column.
                                                                                                                                                                                                                                                                                                                                                                                                                                          function makePlacement(target, rand){
                                                                                                                                                                                                                                                                                                                                                                                                                                              const place = Array.from({length:ROWS}, ()=>Array(COLS).fill(false));
                                                                                                                                                                                                                                                                                                                                                                                                                                                  const remaining = target.slice();

                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let r=0; r<ROWS; r++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                            // columns with remaining > 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const available = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (remaining[c] > 0) available.push(c);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (available.length < 5) return null;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // prioritize higher remaining, random tie-break
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const tiebreak = {};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let c=0;c<COLS;c++) tiebreak[c] = rand();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    available.sort((a,b)=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const da = remaining[a], db = remaining[b];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (db !== da) return db - da;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return tiebreak[a] - tiebreak[b];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // pick 5 unique
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const chosen = available.slice(0,5);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // apply
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (const c of chosen){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  place[r][c] = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          remaining[c]--;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // must exactly hit all zeros
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (remaining[c] !== 0) return null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          return place;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              function pickUniqueNumbersInRange(lo, hi, count, rand){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const pool = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let x=lo; x<=hi; x++) pool.push(x);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          shuffleWithRand(pool, rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              return pool.slice(0, count).sort((a,b)=>a-b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function buildTicket(seedHex){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const rand = mulberry32(seedToUint32(seedHex));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // fixed targets per seed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const target = makeTargets(rand);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // placement retry (rare to fail, but we guarantee)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      let place = null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let attempt=0; attempt<200; attempt++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // make a derived rand stream per attempt (deterministic-ish)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const r2 = mulberry32((seedToUint32(seedHex) ^ (attempt * 0x9e3779b9)) >>> 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            place = makePlacement(target, r2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (place) break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (!place){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // fallback: extremely unlikely; still return something safe
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      place = makePlacement(target, rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // assign numbers per column
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const colNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const [lo, hi] = RANGES[c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  colNums[c] = pickUniqueNumbersInRange(lo, hi, target[c], rand);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // place numbers top->bottom within each column
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const grid = Array.from({length:ROWS}, ()=>Array(COLS).fill(null));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const rows = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let r=0;r<ROWS;r++) if (place[r][c]) rows.push(r);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    rows.sort((a,b)=>a-b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const nums = colNums[c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for (let i=0;i<rows.length;i++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        grid[rows[i]][c] = nums[i];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return grid;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // ========= State =========
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const LS_KEY = "loto_player_ticket_v4";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              let state = { seed: null, markedNums: [], markedCells: [] };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function loadState(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const raw = localStorage.getItem(LS_KEY);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (raw){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              try { state = { ...state, ...JSON.parse(raw) }; } catch {}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const seedParam = url.searchParams.get("seed");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (seedParam && /^[0-9a-fA-F]{16,64}$/.test(seedParam)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const sp = seedParam.toLowerCase();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (state.seed !== sp){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  state.seed = sp;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!state.seed) state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!Array.isArray(state.markedNums)) state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!Array.isArray(state.markedCells)) state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // ========= UI =========
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const seedText = document.getElementById("seedText");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const markedCount = document.getElementById("markedCount");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const gridEl = document.getElementById("grid");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const btnNewCard = document.getElementById("btnNewCard");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const btnResetMarks = document.getElementById("btnResetMarks");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const btnCopyLink = document.getElementById("btnCopyLink");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            let markedNumSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              let markedCellSet = new Set();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function updateCount(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedCount.textContent = String(markedNumSet.size + markedCellSet.size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        function render(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            seedText.textContent = state.seed;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const ticket = buildTicket(state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    gridEl.innerHTML = "";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (let r=0;r<ROWS;r++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              for (let c=0;c<COLS;c++){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const val = ticket[r][c];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const key = `${r}-${c}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const b = document.createElement("button");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.type = "button";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (val == null){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b.className = "cell cell--empty";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.textContent = " ";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (markedCellSet.has(key)) b.classList.add("is-marked");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (markedCellSet.has(key)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        markedCellSet.delete(key);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                markedCellSet.add(key);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      state.markedCells = [...markedCellSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              updateCount();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.className = "cell";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b.textContent = String(val);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (markedNumSet.has(val)) b.classList.add("is-marked");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.addEventListener("click", () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (markedNumSet.has(val)){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  markedNumSet.delete(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b.classList.remove("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          markedNumSet.add(val);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.classList.add("is-marked");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                state.markedNums = [...markedNumSet];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        updateCount();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  gridEl.appendChild(b);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                updateCount();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            history.replaceState({}, "", url);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function newCard(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    state.seed = makeSeed128();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                markedNumSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    markedCellSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            render();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function resetMarksKeepSeed(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    state.markedNums = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        state.markedCells = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            markedNumSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                markedCellSet = new Set();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    saveState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        render();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            async function copyLink(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const url = new URL(location.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    url.searchParams.set("seed", state.seed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              await navigator.clipboard.writeText(url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    btnCopyLink.textContent = "‚úÖ ƒê√£ sao ch√©p";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          setTimeout(()=> btnCopyLink.textContent = "üîó Sao ch√©p li√™n k·∫øt t·ªù", 1200);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }catch{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    prompt("Sao ch√©p li√™n k·∫øt n√†y:", url.toString());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            loadState();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              markedNumSet = new Set(state.markedNums);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                markedCellSet = new Set(state.markedCells);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  render();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    btnNewCard.addEventListener("click", newCard);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      btnResetMarks.addEventListener("click", resetMarksKeepSeed);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        btnCopyLink.addEventListener("click", copyLink);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </html>